---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allApps = (await getCollection('apps'))
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

// Category filter options - must match the enum in src/content/config.ts
const categories = ['all', 'productivity', 'utility', 'developer', 'other'] as const;
---

<Layout 
  title="Apps - TinyKite" 
  description="Browse our collection of utility apps designed to make your life easier."
>
  <section class="py-20">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">Our Apps</h1>
        <p class="text-xl text-gray-600 dark:text-gray-400">
          Discover utility apps built to solve real problems.
        </p>
      </div>

      <!-- Category Filter -->
      <div class="flex flex-wrap gap-4 justify-center mb-12">
        {categories.map(category => (
          <button
            data-category={category}
            class="category-filter px-6 py-2 rounded-full border-2 border-gray-300 dark:border-dark-light hover:border-primary dark:hover:border-primary transition-colors capitalize"
          >
            {category}
          </button>
        ))}
      </div>

      <!-- Apps Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {allApps.length > 0 ? (
          allApps.map(app => (
            <a 
              href={`/apps/${app.slug}`}
              class="app-card block p-6 bg-white dark:bg-dark-lighter rounded-lg border border-gray-200 dark:border-dark-light hover:border-primary dark:hover:border-primary transition-all hover:shadow-lg"
              data-category={app.data.category}
            >
              {app.data.icon && (
                <div class="text-4xl mb-4">{app.data.icon}</div>
              )}
              <div class="flex items-center justify-between mb-2">
                <h3 class="text-xl font-semibold">{app.data.title}</h3>
                {app.data.featured && (
                  <span class="text-xs px-2 py-1 bg-primary text-white rounded-full">Featured</span>
                )}
              </div>
              <p class="text-gray-600 dark:text-gray-400 mb-4">{app.data.description}</p>
              <span class="text-sm text-primary capitalize">{app.data.category}</span>
            </a>
          ))
        ) : (
          <div class="col-span-3 text-center text-gray-600 dark:text-gray-400 py-12">
            <p>No apps available yet. Check back soon!</p>
          </div>
        )}
      </div>
    </div>
  </section>
</Layout>

<script>
  const categoryFilters = document.querySelectorAll('.category-filter');
  const appCards = document.querySelectorAll('.app-card');

  categoryFilters.forEach(filter => {
    filter.addEventListener('click', () => {
      const category = filter.getAttribute('data-category');

      // Update active filter
      categoryFilters.forEach(f => {
        f.classList.remove('border-primary', 'bg-primary', 'text-white', 'dark:border-primary');
        f.classList.add('border-gray-300', 'dark:border-dark-light');
      });
      filter.classList.remove('border-gray-300', 'dark:border-dark-light');
      filter.classList.add('border-primary', 'bg-primary', 'text-white', 'dark:border-primary');

      // Filter apps
      appCards.forEach(card => {
        const cardCategory = card.getAttribute('data-category');
        if (category === 'all' || cardCategory === category) {
          card.classList.remove('hidden');
        } else {
          card.classList.add('hidden');
        }
      });
    });
  });

  // Set initial active state to 'all'
  const allFilter = document.querySelector('[data-category="all"]');
  if (allFilter) {
    allFilter.classList.remove('border-gray-300', 'dark:border-dark-light');
    allFilter.classList.add('border-primary', 'bg-primary', 'text-white', 'dark:border-primary');
  }
</script>
