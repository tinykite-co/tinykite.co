---
import Layout from "../layouts/Layout.astro";
import { apps } from "../data/apps";
---

<Layout title="TinyKite - We innovate. We build. We connect.">
  <!-- Single Screen Hero - Fixed Height, No Page Scroll -->
  <div
    class="fixed inset-0 overflow-hidden bg-background dark:bg-background-dark"
  >
    <!-- Desktop Layout -->
    <div class="hidden lg:flex h-full items-center justify-center px-8">
      <div class="grid grid-cols-3 gap-12 items-center max-w-7xl w-full">
        <!-- Left Phone - iPhone -->
        <div class="flex flex-col items-center justify-center">
          <div
            class="relative w-72 h-[600px] bg-gray-900 rounded-[3rem] p-3 shadow-2xl"
          >
            <!-- iPhone Notch -->
            <div
              class="absolute top-0 left-1/2 -translate-x-1/2 w-40 h-7 bg-gray-900 rounded-b-3xl z-10"
            >
            </div>
            <!-- Phone Screen with Scrollable Content -->
            <div
              id="iphone-screen"
              class="relative w-full h-full bg-white rounded-[2.5rem] overflow-hidden"
            >
              <div
                class="h-full overflow-y-auto snap-y snap-mandatory scrollbar-hide"
                id="phone-scroll-container"
              >
                {
                  apps.map((app) => (
                    <div
                      class="h-full snap-start relative"
                      data-app-id={app.id}
                    >
                      <img
                        src={app.screenshot}
                        alt={`${app.name} screenshot`}
                        class="w-full h-full object-cover"
                      />
                    </div>
                  ))
                }
              </div>
            </div>
          </div>
          <p
            id="iphone-label"
            class="mt-6 text-sm font-medium text-gray-600 dark:text-gray-400"
          >
            Community Hub
          </p>
        </div>

        <!-- Center Content -->
        <div class="text-center space-y-6">
          <div>
            <h1
              class="text-5xl font-bold text-gray-900 dark:text-white mb-4 leading-tight"
            >
                 <span id="typed-text"></span><span id="cursor">|</span>
            </h1>
            <p
              class="text-lg text-gray-600 dark:text-gray-400 max-w-lg mx-auto"
            >
              TinyKite is a product studio crafting a seamless ecosystem of apps
              that empower and inspire.
            </p>
          </div>
        
          <!-- Dynamic App Showcase -->
<!-- Center Content (replace existing showcase block) -->
<div class="text-center space-y-6">
  

  <!-- Improved Center Card -->
  <div
    id="center-card"
    class="w-full max-w-3xl mx-auto bg-white dark:bg-[#0b0b0b] rounded-2xl p-6 md:p-8 shadow-2xl border border-gray-100 dark:border-dark-light relative z-30
           max-h-[62vh] md:max-h-[52vh] overflow-auto"
  >
    <!-- Title + description -->
    <div class="mb-4">
      <h2 id="app-title" class="text-2xl font-semibold text-gray-900 dark:text-white">
        Community Hub
      </h2>
      <p id="app-description" class="text-sm text-gray-600 dark:text-gray-400 mt-2">
        Connect with like-minded individuals, join groups, and share passions in a vibrant, safe space.
      </p>
    </div>

    <!-- App store badges -->
    <div class="flex justify-center items-center gap-2 mb-2 relative z-10 flex-wrap">
  <a
    href="https://apps.apple.com/app/community-hub"
    target="_blank"
    rel="noopener noreferrer"
    class="transform hover:scale-105 transition-transform"
  >
  <span
      class="inline-flex items-center justify-center leading-none rounded-md overflow-hidden"
    >
    <img
      src="/app-store-badge.svg"
      alt="Download on App Store"
      class="h-[45px] w-auto object-contain block"
      loading="eager"
    />  
  </span>
    
  </a>
  <a
    href="https://play.google.com/store/apps/details?id=com.tinykite.communityhub"
    target="_blank"
    rel="noopener noreferrer"
    class="transform hover:scale-105 transition-transform"
  >
    <span
      class="inline-flex items-center justify-center leading-none rounded-md overflow-hidden"
    >
    <img
      src="/google-play-badge.svg"
      alt="Get it on Google Play"
      class="h-[55px] w-auto object-contain block"
      loading="eager"
    /> 
  </span>
    
  </a>
</div>

    <!-- CTA Buttons: stacked on small, two columns on md+ -->
    <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3 items-stretch">
      <a
        href="/apps"
        class="flex items-center justify-center px-3 py-1 rounded-lg font-semibold text-white bg-gradient-to-r from-primary to-secondary shadow-md hover:opacity-95 transition-opacity
               w-full h-full"
      >
        Explore Our Apps → 
      </a>

      <a
        href="/about"
        class="flex items-center justify-center px-3 py-1 rounded-lg font-semibold border-2 border-primary text-primary dark:text-primary bg-transparent hover:bg-primary hover:text-white transition-colors
               w-full h-full"
      >
        Request an App →
      </a>
    </div>

    <!-- optional small hint / footer inside card -->
    <p class="text-xs text-gray-500 dark:text-gray-500 mt-4">Scroll the phone previews left/right to see screenshots</p>
    <!-- Desktop Indicator Dots -->
<div id="desktop-indicators" class="hidden lg:flex justify-center mt-4 gap-2">
  {apps.map((app, index) => (
    <div
      class={`w-2 h-2 rounded-full transition-colors ${
        index === 0 ? "bg-gray-900 dark:bg-white" : "bg-gray-300 dark:bg-gray-600"
      }`}
      data-indicator-desktop={app.id}
    />
  ))}
</div>

  </div>

  <p class="text-sm text-gray-500 dark:text-gray-500 flex items-center justify-center gap-2">
    Scroll to see our portfolio
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
    </svg>
  </p>
</div>

        </div>

        <!-- Right Phone - Android -->
        <div class="flex flex-col items-center justify-center">
          <div
            class="relative w-72 h-[600px] bg-gray-900 rounded-[2.5rem] p-3 shadow-2xl"
          >
            <!-- Phone Screen with Scrollable Content -->
            <div
              id="android-screen"
              class="relative w-full h-full bg-white rounded-[2rem] overflow-hidden"
            >
              <div
                class="h-full overflow-y-auto snap-y snap-mandatory scrollbar-hide"
                id="phone-scroll-container-android"
              >
                {
                  apps.map((app) => (
                    <div
                      class="h-full snap-start relative"
                      data-app-id={app.id}
                    >
                      <img
                        src={app.screenshot}
                        alt={`${app.name} screenshot`}
                        class="w-full h-full object-cover"
                      />
                    </div>
                  ))
                }
              </div>
            </div>
            <!-- Android Navigation Bar -->
            <div
              class="absolute bottom-1 left-1/2 -translate-x-1/2 w-32 h-1 bg-gray-700 rounded-full"
            >
            </div>
          </div>
          <p
            id="android-label"
            class="mt-6 text-sm font-medium text-gray-600 dark:text-gray-400"
          >
            Community Hub
          </p>
        </div>
      </div>
    </div>

    <!-- Mobile Layout -->
    <div class="lg:hidden flex flex-col h-full overflow-hidden">
      <div class="flex-1 flex items-center justify-center px-4 py-8">
        <div class="text-center space-y-6 max-w-md">
          <div>
            <h1
              class="text-5xl font-bold text-gray-900 dark:text-white mb-4 leading-tight"
            >
              <span id="typed-text-mobile"></span><span id="cursor-mobile">|</span>
            </h1>
            <p class="text-base text-gray-600 dark:text-gray-400">
              TinyKite is a product studio crafting a seamless ecosystem of apps
              that empower and inspire.
            </p>
          </div>

          <!-- App Showcase -->
          <div
            class="bg-background/80 dark:bg-background-dark/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg relative"
          >
            <!-- Scroll Indicators -->
            <div
              class="absolute right-4 top-1/2 -translate-y-1/2 flex flex-col gap-2 z-10"
            >
              {
                apps.map((app, index) => (
                  <div
                    class={`w-2 h-2 rounded-full transition-colors ${index === 0 ? "bg-gray-900 dark:bg-white" : "bg-gray-300 dark:bg-gray-600"}`}
                    data-indicator={app.id}
                  />
                ))
              }
            </div>

            <h2
              id="app-title-mobile"
              class="text-xl font-bold text-gray-900 dark:text-white mb-2"
            >
              Community Hub
            </h2>
            <p
              id="app-description-mobile"
              class="text-sm text-gray-600 dark:text-gray-400 mb-4"
            >
              Connect with like-minded individuals, join groups, and share
              passions in a vibrant, safe space.
            </p>

            <!-- App Store Badges -->
            <div class="flex justify-center items-center gap-1 mb-6 relative z-10 flex-wrap">
  <a
    href="https://apps.apple.com/app/community-hub"
    target="_blank"
    rel="noopener noreferrer"
    class="transform hover:scale-105 transition-transform"
  >
  <span
      class="inline-flex items-center justify-center leading-none rounded-md overflow-hidden"
    >
    <img
      src="/app-store-badge.svg"
      alt="Download on App Store"
      class="h-[50px] w-auto object-contain block"
      loading="eager"
    />  
  </span>
    
  </a>
  <a
    href="https://play.google.com/store/apps/details?id=com.tinykite.communityhub"
    target="_blank"
    rel="noopener noreferrer"
    class="transform hover:scale-105 transition-transform"
  >
    <span
      class="inline-flex items-center justify-center leading-none rounded-md overflow-hidden"
    >
    <img
      src="/google-play-badge.svg"
      alt="Get it on Google Play"
      class="h-[60px] w-auto object-contain block"
      loading="eager"
    /> 
  </span>
    
  </a>
</div>

            <!-- CTA Buttons -->
            <div class="flex flex-col gap-3">
              <a
                href="/apps"
                class="px-4 py-2 bg-gradient-to-r from-primary to-secondary text-white font-semibold rounded-lg hover:opacity-90 transition-opacity shadow-lg text-center"
              >
                Explore Our Apps
              </a>
              <a
                href="/about"
                class="px-4 py-2 border-2 border-primary text-primary font-semibold rounded-lg hover:bg-primary hover:text-white transition-colors text-center"
              >
                Learn Our Story →
              </a>
            </div>
          </div>

          <p
            class="text-sm text-gray-500 dark:text-gray-500 flex items-center justify-center gap-2"
          >
            Scroll to see our portfolio
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
            </svg>
          </p>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script define:vars={{ apps }}>
  const appsData = apps || [];
  let currentAppIndex = 0;

  // Utility to get app index safely by id (returns -1 if not found)
  function indexForAppId(appId) {
    return appsData.findIndex((a) => a.id === appId);
  }

  function updateAppContentByIndex(index) {
    if (index < 0 || index >= appsData.length) return;
    const app = appsData[index];

    // Desktop elements
    const titleEl = document.getElementById("app-title");
    const descEl = document.getElementById("app-description");
    const appStoreLink = document.getElementById("appstore-link");
    const playStoreLink = document.getElementById("playstore-link");
    const iphoneLabel = document.getElementById("iphone-label");
    const androidLabel = document.getElementById("android-label");

    if (titleEl) titleEl.textContent = app.name;
    if (descEl) descEl.textContent = app.description;
    if (appStoreLink && app.appStoreUrl) appStoreLink.href = app.appStoreUrl;
    if (playStoreLink && app.playStoreUrl) playStoreLink.href = app.playStoreUrl;
    if (iphoneLabel) iphoneLabel.textContent = app.name;
    if (androidLabel) androidLabel.textContent = app.name;

    // Mobile elements
    const titleMobile = document.getElementById("app-title-mobile");
    const descMobile = document.getElementById("app-description-mobile");
    const appStoreLinkMobile = document.getElementById("appstore-link-mobile");
    const playStoreLinkMobile = document.getElementById("playstore-link-mobile");

    if (titleMobile) titleMobile.textContent = app.name;
    if (descMobile) descMobile.textContent = app.description;
    if (appStoreLinkMobile && app.appStoreUrl) appStoreLinkMobile.href = app.appStoreUrl;
    if (playStoreLinkMobile && app.playStoreUrl) playStoreLinkMobile.href = app.playStoreUrl;

  // Desktop indicators
const desktopIndicators = document.querySelectorAll("[data-indicator-desktop]");

desktopIndicators.forEach((indicator, idx) => {
  if (idx === index) {
    indicator.classList.remove("bg-gray-300", "dark:bg-gray-600");
    indicator.classList.add("bg-gray-900", "dark:bg-white");
  } else {
    indicator.classList.remove("bg-gray-900", "dark:bg-white");
    indicator.classList.add("bg-gray-300", "dark:bg-gray-600");
  }
});
  desktopIndicators.forEach((indicator, idx) => {
  indicator.addEventListener("click", () => {
    currentAppIndex = idx;
    scrollPhonesToIndex(currentAppIndex);
    updateAppContentByIndex(currentAppIndex);
  });
});


    // Indicators: compare by index (not by id)
  const indicators = document.querySelectorAll("[data-indicator]");
  if (!indicators || indicators.length === 0) return;

  // sanity: warn if counts mismatch with slides
  const iphoneContainer = document.getElementById("phone-scroll-container");
  if (iphoneContainer && indicators.length !== iphoneContainer.children.length) {
    console.warn("tinykite: indicator/slide count mismatch", indicators.length, iphoneContainer.children.length);
  }

  indicators.forEach((indicator, idx) => {
    if (idx === index) {
      indicator.classList.remove("bg-gray-300", "dark:bg-gray-600");
      indicator.classList.add("bg-gray-900", "dark:bg-white");
    } else {
      indicator.classList.remove("bg-gray-900", "dark:bg-white");
      indicator.classList.add("bg-gray-300", "dark:bg-gray-600");
    }
  });
  }

  // Scroll both phone containers to a given index (smooth)
  function scrollPhonesToIndex(index) {
  if (typeof index !== "number" || index < 0) return;

  const iphoneContainer = document.getElementById("phone-scroll-container");
  const androidContainer = document.getElementById("phone-scroll-container-android");

  // Defensive: ensure children exist
  const iphoneChild = iphoneContainer?.children?.[index];
  const androidChild = androidContainer?.children?.[index];

  if (!iphoneChild && !androidChild) {
    console.warn("tinykite: no slide found at index", index, {
      iphoneChildren: iphoneContainer?.children?.length,
      androidChildren: androidContainer?.children?.length
    });
    return;
  }

  // Preferred: use scrollTo for consistent behavior if you control slide height
  if (iphoneContainer && iphoneChild) {
    // smooth scroll to the child's offsetTop relative to container
    iphoneContainer.scrollTo({ top: iphoneChild.offsetTop, behavior: "smooth" });
  } else if (iphoneChild) {
    iphoneChild.scrollIntoView({ behavior: "smooth", block: "start" });
  }

  if (androidContainer && androidChild) {
    androidContainer.scrollTo({ top: androidChild.offsetTop, behavior: "smooth" });
  } else if (androidChild) {
    androidChild.scrollIntoView({ behavior: "smooth", block: "start" });
  }
}

  // Wheel + touch handling (debounced-ish)
  let scrollTimeout;
  function handleWheel(e) {
    // prevent default only if we can handle movement (avoid locking page scrolling)
    if (!appsData.length) return;
    e.preventDefault();

    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(() => {
      if (e.deltaY > 0 && currentAppIndex < appsData.length - 1) {
        currentAppIndex++;
      } else if (e.deltaY < 0 && currentAppIndex > 0) {
        currentAppIndex--;
      } else {
        return;
      }

      scrollPhonesToIndex(currentAppIndex);
      updateAppContentByIndex(currentAppIndex);
    }, 50);
  }

  if (typeof window !== "undefined") {
    // initialize UI
    updateAppContentByIndex(currentAppIndex);

    // Wheel
    window.addEventListener("wheel", handleWheel, { passive: false });

    // Touch swipe
    let touchStartY = 0;
    window.addEventListener("touchstart", (e) => {
      touchStartY = e.touches?.[0]?.clientY || 0;
    });

    window.addEventListener("touchmove", (e) => {
      if (!appsData.length) return;
      const touchY = e.touches?.[0]?.clientY || 0;
      const diff = touchStartY - touchY;

      if (Math.abs(diff) > 50) {
        if (diff > 0 && currentAppIndex < appsData.length - 1) {
          currentAppIndex++;
          scrollPhonesToIndex(currentAppIndex);
          updateAppContentByIndex(currentAppIndex);
        } else if (diff < 0 && currentAppIndex > 0) {
          currentAppIndex--;
          scrollPhonesToIndex(currentAppIndex);
          updateAppContentByIndex(currentAppIndex);
        }
        touchStartY = touchY;
      }
    });

    // Optional: click indicators to jump to app (if you want)
    const indicators = document.querySelectorAll("[data-indicator]");
    indicators.forEach((indicator, idx) => {
      indicator.addEventListener("click", () => {
        currentAppIndex = idx;
        scrollPhonesToIndex(currentAppIndex);
        updateAppContentByIndex(currentAppIndex);
      });
    });
  }

  // related to the heading

function startTypewriter(textEl, cursorEl) {
  const phrases = ["We innovate.", "We build.", "We connect."];

  if (!textEl || !cursorEl) return;

  let phraseIndex = 0;
  let charIndex = 0;
  let deleting = false;

  const typeSpeed = 100;
  const eraseSpeed = 60;
  const delayAfterFinish = 1000;

  function loop() {
    const current = phrases[phraseIndex];

    if (!deleting) {
      textEl.textContent = current.substring(0, charIndex++);
      if (charIndex > current.length) {
        deleting = true;
        return setTimeout(loop, delayAfterFinish);
      }
    } else {
      textEl.textContent = current.substring(0, charIndex--);
      if (charIndex < 0) {
        deleting = false;
        phraseIndex = (phraseIndex + 1) % phrases.length;
      }
    }

    setTimeout(loop, deleting ? eraseSpeed : typeSpeed);
  }

  loop();
}

// Desktop
startTypewriter(
  document.getElementById("typed-text"),
  document.getElementById("cursor")
);

// Mobile
startTypewriter(
  document.getElementById("typed-text-mobile"),
  document.getElementById("cursor-mobile")
);




</script>

<style>
  /* Hide scrollbar but keep functionality */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  #cursor {
  display: inline-block;
  margin-left: 2px;
  animation: blink 0.7s infinite;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

/* Ensure center card always sits above header and phone elements */
#center-card { z-index: 30; }

/* keep buttons identical height and full width within grid cells */
#center-card a { min-height: 48px; }

/* On very short desktop heights (Nest Hub) allow a little scaling so everything fits */
@media (min-width: 1024px) and (max-height: 650px) {
  #center-card {
    transform-origin: top center;
    transform: translateY(0) scale(0.92);
  }
}

/* Optional: prevent the title from truncating too aggressively — allow wrap */
#center-card #app-title { white-space: normal; }

/* Make card internal scrolling smooth, but keep it visually compact */
#center-card::-webkit-scrollbar { height: 6px; width: 6px; }
#center-card::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.08); border-radius: 9999px; }


</style>
